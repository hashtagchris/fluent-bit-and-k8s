apiVersion: apps/v1
kind: Deployment
metadata:
  name: high-volume-logger
  namespace: default
  labels:
    app: high-volume-logger
spec:
  replicas: 1
  selector:
    matchLabels:
      app: high-volume-logger
  template:
    metadata:
      labels:
        app: high-volume-logger
      annotations:
        fluentbit.io/parser: logfmt
    spec:
      containers:
      - name: logger
        image: alpine:latest
        command: ["/bin/sh"]
        args:
          - -c
          - |
            while true; do
              for i in $(seq 1 99); do
                # pad i with a leading zero
                padded_i=$(printf "%02d" $i)

                # This logs at a rate of 1.6 MB/sec or 800 msg/sec
                # 1.6 MB/sec is enough for the log file to get rotated every 10 seconds by k8s
                for j in $(seq 1 999); do
                  # pad j with leading zeros
                  padded_j=$(printf "%03d" $j)

                  # Generate 1,000 log lines
                  yes "seq=${padded_i}${padded_j} level=error msg=\"Failed to connect to external service\" service=payment-api retry_count=3 f001=72d29fb1a7021318a78a3e5f10143b31 f002=240ba92a6f9d231f98fc9a98da04e68f f003=5dbbb12b83d20e0c77bce78ae245de46 f004=9b88086e349c9e3ac0bda4c805d0a314 f005=b6818a4ea1eaf03c6cad9bb0e065dccf f006=3678280e6be9f621228df4fb6db5ae2d f007=f88858d99e5a2f4351f8df23af65072c f008=b444544f265a9ac6a11204347d3066ed f009=672eecde8671b3794a9c263c76f61206 f010=85dc931e169fa62642e6991ecbc33306 f011=57243224dcfe586f17878d02d7b9d762 f012=f58505b554ca2d9a22459a8b66175829 f013=c8c4121eb9fb33d635ea8e410202451e f014=d90664fc0dca3c863a1cb6dc3d0bb5b2 f015=7824b92ed65011d0bb9822c2205934da f016=242e67db6e621de100763e86a5729d9d f017=510a7db8d47a2060741316dad9d63d09 f018=1843525534b074eaab1e11fa8f77b20b f019=03cd5b79bf0131eee097a5bd60343dbe f020=c452f1f88435c554b0dc370675b3cee9 f021=a5bdc3650b0c507cc4f811230d7cb50c f022=08112fc7d7d2de9fa4d3824a23345098 f023=3bbbf5b1721fd91be72113ff792c54fa f024=2b337a55673009828faaddd843a4e53d f025=067c182774c60af29942dd2185fd08ba f026=829de4206a39c72776dcd8ec66185907 f027=4a2c3354328decb3607c5f2ee3181f6e f028=a8b3991883e76c2775c6f178a3b64b27 f029=a41b411dd2337cf0d05a268639d71a30 f030=c8656573bb96a9037335526f0ac1789a f031=13ede783af791c335000d45d5eda9f27 f032=6e0faad676070d18a9d52d7a1282528a f033=2b3a5f5d6fb4e292821535abd344f2b2 f034=67b387826dc8941209474e1166b216df f035=fa5097f8c67bf0bd5e3acebf1f327d93 f036=2b7eef149dd2aba3a898234d442d041d f037=0710effa2706138fc97c4db6161df1cc f038=ead89ff1b7498583047e012beac77f8b f039=a48ca646790b83e79ba3e66efc41aa72 f040=bd8bcf9a6f75448adf0ae9735bb3ab2d f041=2f4e6150f3caa21ca834490280b4836d f042=525d440629d81b8c6c53d4e3df891e0f f043=bf15ba723c663a34b51972bea7fef7dd f044=4c191ea6e2f606c353e9674b27e9d8d1 f045=6bd930c45696bcad1bb72951913c5828 f046=5f017752b49c5d91e0ae2cb4c85ae8d6 f047=a53bd6d8bf48e340fc244b5256268880 f048=b1ea486b6cf2b7a25854bcbb64e89ada f049=61149bddb793bfd809c819137f745c72 f050=8e5c41bd284420943fe9f631af5a0730 f051=dc09f15e7ab61927de22011a96af389a" | head -1000
                  sleep 1
                done
                sleep 60
              done
            done
        env:
        - name: HOSTNAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        resources:
          requests:
            cpu: 50m
            memory: 32Mi
          limits:
            cpu: 100m
            memory: 64Mi
